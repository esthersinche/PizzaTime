name: Sprint 5 deploy

on:
  workflow_dispatch:  
  push:
    branches:
      - main

jobs:
  build-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v3

      - name: Configurar JDK 20
        uses: actions/setup-java@v3
        with:
          java-version: '20'
          distribution: 'temurin'

      - name: Instalar dependencias y compilar
        run: mvn clean install -DskipTests=false

      - name: Pruebas automáticas
        run: |
          echo "Ejecutando pruebas unitarias..."
          mvn test
          echo "Pruebas completadas exitosamente"

  simulate-deploy-db:
    runs-on: ubuntu-latest
    needs: build-test
    steps:
      - name: Despliegue de base de datos
        run: |
          echo "Iniciando despliegue de BD..."
          echo "   - Validando scripts SQL..."
          echo "   - Sincronizando esquemas..."
          echo "   - Migración completada"
          echo "BD DESPLEGADA"

  simulate-deploy-app:
    runs-on: ubuntu-latest
    needs: simulate-deploy-db
    steps:
      - name: Empaquetado de artefacto
        run: |
          echo " Empaquetando artefacto Java..."
          echo "   - Generando .jar..."
          echo "   - Artefacto creado correctamente"

      - name: Despliegue de la aplicación
        run: |
          echo "Iniciando despliegue"
          echo "   - Subiendo artefacto a servidor Azure..."
          echo "   - Actualizando versión..."
          echo "   - Reiniciando servicio..."
          echo "APLICACIÓN DESPLEGADA"
